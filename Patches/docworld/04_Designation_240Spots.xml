<?xml version="1.0" encoding="utf-8"?>

<!--
    This file is under the Gnu General Public License version 3, see https://www.gnu.org/licenses/gpl-3.0.txt for more information.
-->

<Patch>
    <Operation Class="XmlExtensions.OptionalPatch">
        <modId>carnap2.TPatches</modId>
        <key>DocWorld_DesignationCategories</key>
        <defaultValue>true</defaultValue>
        <caseTrue>
            <Operation Class="XmlExtensions.OptionalPatch">
                <modId>carnap2.TPatches</modId>
                <key>DocWorld_DesignationCategoriesSpots</key>
                <defaultValue>true</defaultValue>
                <caseTrue>

                    <Operation Class="XmlExtensions.PatchOperationAddOrReplace">
                        <xpath>Defs/ThingDef[designationCategory][
                            contains(label, "spot") or 
                            contains(label, "Spot") or 
                            contains(@Name, "spot") or 
                            contains(@Name, "Spot")]</xpath>
                        <value>
                            <designationCategory Inherit="False">NQoL_Spots</designationCategory>
                        </value>
                    </Operation>

                    <!-- fix non spot spots -->
                    <Operation Class="XmlExtensions.FindMod">
                        <mods>
                            <li>Edo Themed Expansion</li>
                        </mods>
                        <caseTrue>
                            <Operation Class="XmlExtensions.PatchOperationAddOrReplace">
                                <xpath>/Defs/ThingDef[
                                defName="HSEdoTailorSpot"
                                ]</xpath>
                                <value>
                                    <designationCategory>Production</designationCategory>
                                </value>
                            </Operation>

                            <Operation Class="XmlExtensions.PatchOperationAddOrReplace">
                                <xpath>/Defs/ThingDef[
                                defName="HS_HaikuSpot" or 
                                defName="HSShogiboard"
                                ]</xpath>
                                <value>
                                    <designationCategory>Joy</designationCategory>
                                </value>
                            </Operation>

                        </caseTrue>
                    </Operation>


                    <!-- replace -->
                    <Operation Class="PatchOperationReplace">
                        <xpath>Defs/ThingDef[designationCategory and useHitPoints="False"]/designationCategory</xpath>
                        <value>
                            <designationCategory>NQoL_Spots</designationCategory>
                        </value>
                    </Operation>

                    <Operation Class="PatchOperationFindMod">
                        <mods>
                            <li>Vanilla Outposts Expanded</li>
                        </mods>
                        <match Class="XmlExtensions.PatchOperationAddOrReplace">
                            <success>Always</success>
                            <xpath>/Defs/ThingDef[
                                defName="VEF_OutpostDeliverySpot"
                                ]</xpath>
                            <value>
                                <designationCategory>NQoL_Spots</designationCategory>
                            </value>
                        </match>
                    </Operation>

                    <Operation Class="PatchOperationFindMod">
                        <mods>
                            <li>Vanilla Storytellers Expanded - Winston Wave</li>
                        </mods>
                        <match Class="XmlExtensions.PatchOperationAddOrReplace">
                            <success>Always</success>
                            <xpath>/Defs/ThingDef[
                                defName="VESWW_RewardDropSpot"
                                ]</xpath>
                            <value>
                                <designationCategory>NQoL_Spots</designationCategory>
                            </value>
                        </match>
                    </Operation>


                    <!-- patches go above this -->
                </caseTrue>
                <caseFalse />
            </Operation>
        </caseTrue>
    </Operation>
</Patch>